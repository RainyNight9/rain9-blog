import{_ as s,o as a,c as t,e as p}from"./app-f89883cd.js";const e={};function o(c,n){return a(),t("div",null,[...n[0]||(n[0]=[p(`<h1 id="cdn-容错" tabindex="-1"><a class="header-anchor" href="#cdn-容错" aria-hidden="true">#</a> CDN 容错</h1><h2 id="现象" tabindex="-1"><a class="header-anchor" href="#现象" aria-hidden="true">#</a> 现象</h2><p>用户访问不了页面。发现用户 static.xxxx.com 的所有文件都加载失败了</p><p>终端 <code>ping static.xxxx.com</code> 正常</p><p>前端的静态资源访问以cdn为主，但也带来一系列的问题：</p><ol><li>cdn本身的稳定性问题</li><li>用户所在运营商网络问题</li><li>用户dns缓存</li><li>其他未知问题</li></ol><p>这些都可能导致用户加载资源失败，从我们的实时日志来看，每天都有几十、上百例资源加载失败的。</p><h2 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h2><h3 id="可以先尝试清理用户的dns缓存-或者修改用户路由器的dns解析服务器" tabindex="-1"><a class="header-anchor" href="#可以先尝试清理用户的dns缓存-或者修改用户路由器的dns解析服务器" aria-hidden="true">#</a> 可以先尝试清理用户的dns缓存，或者修改用户路由器的dns解析服务器</h3><ul><li>https://test-ipv6.com/index.html.zh_CN 检测用户网络环境是否支持 ipv6</li><li>尝试清除一下用户本地 dns 缓存，https://jingyan.baidu.com/article/546ae1851b79d51149f28c8d.html</li></ul><h3 id="前端容错" tabindex="-1"><a class="header-anchor" href="#前端容错" aria-hidden="true">#</a> 前端容错</h3><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> cdnlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;cdn.bootcss2.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;cdn.bootcss.com&#39;</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">handleCDNError</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> index <span class="token operator">=</span> index <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> newsrc <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">:\\/\\/[\\w|.]+\\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;://&#39;</span><span class="token operator">+</span> cdnlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> cdnlist<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;script src=&quot;&#39;</span><span class="token operator">+</span> newsrc <span class="token operator">+</span><span class="token string">&#39;&quot; onerror=&quot;handleCDNError(this, &#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&#39;)&quot;&gt;&lt;\\/script&gt;&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;script src=&quot;&#39;</span><span class="token operator">+</span> newsrc <span class="token operator">+</span><span class="token string">&#39;&quot;&gt;&lt;\\/script&gt;&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss1.com/jquery/3.3.1/jquery.min.js<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">handleCDNError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>https://blog.csdn.net/newchenxf/article/details/51693753</p>`,13)])])}const i=s(e,[["render",o],["__file","cdn_rongcuo.html.vue"]]);export{i as default};
